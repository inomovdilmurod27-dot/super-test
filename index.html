<!DOCTYPE html>
<html lang="uz">
<head>
<meta charset="UTF-8">
<title>Super Panel — Ko‘k-Yashil Zamonaviy Dizayn</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
body {
    margin:0;
    font-family: 'Segoe UI', sans-serif;
    height:100vh;
    background: linear-gradient(135deg, #1abc9c, #16a085);
    display:flex;
    justify-content:center;
    align-items:center;
    overflow:hidden;
}
.container {
    width:500px;
    padding:35px;
    text-align:center;
    border-radius:25px;
    background: rgba(255,255,255,0.1);
    backdrop-filter: blur(25px);
    box-shadow:0 20px 60px rgba(0,0,0,0.4);
    color:white;
    animation: fadeIn 1s ease;
}
@keyframes fadeIn {from {opacity:0; transform:translateY(50px);} to {opacity:1; transform:translateY(0);} }
h1 {font-size:36px; margin-bottom:40px; text-shadow:0 4px 12px rgba(0,0,0,0.5);}
.btn {
    width:100%;
    padding:20px;
    margin:12px 0;
    border:none;
    border-radius:18px;
    font-size:20px;
    cursor:pointer;
    font-weight:700;
    background: linear-gradient(45deg, #00c6ff, #0072ff);
    color:white;
    transition:0.4s;
    box-shadow:0 6px 20px rgba(0,0,0,0.3);
}
.btn:hover {transform:scale(1.05); box-shadow:0 10px 30px rgba(0,0,0,0.5);}
.btn i {margin-right:12px;}
.modal {
    display:none;
    position:fixed;
    top:0; left:0;
    width:100%; height:100%;
    backdrop-filter:blur(12px);
    background: rgba(0,0,0,0.6);
    justify-content:center;
    align-items:center;
    overflow:auto;
}
.modal-content {
    background:white;
    width:80%;
    max-width:1200px;
    min-height:80%;
    border-radius:25px;
    padding:35px;
    text-align:center;
    animation: pop 0.3s ease;
    color:#333;
    position:relative;
    overflow:auto;
}
@keyframes pop {from {transform:scale(0.7); opacity:0;} to {transform:scale(1); opacity:1;} }
input, select, textarea {
    width:90%;
    padding:12px;
    font-size:16px;
    margin-top:8px;
    margin-bottom:12px;
    border-radius:12px;
    border:1px solid #aaa;
    resize:none;
}
.modern-btn {
    padding:12px 25px;
    font-size:16px;
    font-weight:600;
    margin:8px 5px;
    border:none;
    border-radius:12px;
    cursor:pointer;
    color:white;
    transition:0.3s;
}
.login-btn {background: linear-gradient(135deg, #00c6ff, #0072ff);}
.login-btn:hover {transform:scale(1.05); box-shadow:0 8px 25px rgba(0,0,0,0.4);}
.logout-btn {background: linear-gradient(135deg, #1a73e8, #0a47a0);}
.logout-btn:hover {transform:scale(1.05); box-shadow:0 8px 25px rgba(0,0,0,0.4);}
.panel-box {
    text-align:left;
    background:#d1f2eb;
    border-radius:14px;
    padding:22px;
    margin-top:20px;
    max-height:600px;
    overflow-y:auto;
}
.panel-box ul li {margin-bottom:10px;}
.panel-box::-webkit-scrollbar {width:8px;}
.panel-box::-webkit-scrollbar-thumb {background:#888;border-radius:10px;}
.panel-box::-webkit-scrollbar-thumb:hover {background:#555;}
</style>
</head>
<body>

<div class="container" id="mainPanel">
    <h1>Super Panel</h1>
    <button class="btn" onclick="openModal('teacherModal')"><i class="fa-solid fa-chalkboard-user"></i> O‘qituvchi profili</button>
    <button class="btn" onclick="openModal('studentModal')"><i class="fa-solid fa-user-graduate"></i> Talaba profili</button>
    <button class="btn" onclick="openModal('testModal')"><i class="fa-solid fa-pen-to-square"></i> Test tayyorlash</button>
</div>

<!-- O'qituvchi -->
<div class="modal" id="teacherModal">
    <div class="modal-content">
        <h2>O‘qituvchi kirishi</h2>
        <input type="password" id="password" placeholder="Parol" onkeydown="checkEnter(event)">
        <div id="teacherButtons">
            <button class="modern-btn login-btn" onclick="login()">Kirish</button>
            <button class="modern-btn logout-btn" onclick="backToMain('teacherModal')">Orqaga</button>
        </div>
        <div class="panel-box" id="teacherPanel" style="display:none;">
            <h3>Test yaratish</h3>
            <label>Savollarni yozing (namuna format):</label><br>
            <textarea id="questionsTextarea" rows="10" placeholder="++++Savol?
====#to'g'ri javob
====no to'g'ri javob
++++Savol?"></textarea><br>
            <div>
                <label>Savollarni aralashtirish:</label><br>
                <select id="shuffleQuestionsSelect"><option value="ha">Ha</option><option value="yoq">Yo‘q</option></select>
            </div><br>
            <div>
                <label>Javoblarni aralashtirish:</label><br>
                <select id="shuffleAnswersSelect"><option value="ha">Ha</option><option value="yoq">Yo‘q</option></select>
            </div><br>
            <div>
                <label>Savollarni chiqarish tartibi:</label><br>
                <select id="questionOrder"><option value="sequential">Ketma-ket</option><option value="random">Tasodifiy</option></select>
            </div><br>
            <div>
                <label>Testda savol soni:</label><br>
                <input type="number" id="questionCount" min="1" value="10">
            </div><br>
            <div>
                <label>Test vaqti (minutda):</label><br>
                <input type="number" id="testTime" min="1" value="30">
            </div><br>
            <button class="modern-btn login-btn" onclick="generateTestAndBack()">Testni yaratish</button>
        </div>
    </div>
</div>

<!-- Talaba -->
<div class="modal" id="studentModal">
    <div class="modal-content">
        <h2>Talaba profili</h2>
        <input type="text" id="studentName" placeholder="Ismingizni kiriting"><br>
        <button class="modern-btn login-btn" onclick="startStudentTest()">Testni boshlash</button>
        <div id="studentTestArea" style="margin-top:20px; display:none;"></div>
        <button class="modern-btn logout-btn" onclick="backToMain('studentModal')">Orqaga</button>
    </div>
</div>

<!-- Test -->
<div class="modal" id="testModal">
    <div class="modal-content">
        <h2>Test tayyorlash</h2>
        <div class="panel-box">
            <ul>
                <li>✅ Savollar qo‘shish</li>
                <li>✅ Variantlar yaratish</li>
                <li>✅ Word dan yuklash</li>
                <li>✅ Testni PDF/Word ga eksport qilish</li>
                <li>✅ Testni tahrirlash</li>
            </ul>
        </div>
        <button class="modern-btn logout-btn" onclick="backToMain('testModal')">Orqaga</button>
    </div>
</div>

<script>
const mainPanel = document.getElementById("mainPanel");
const teacherPanel = document.getElementById("teacherPanel");
let teacherLoggedIn = false;
let studentTestQuestions = [];

function openModal(modalId){
    mainPanel.style.display="none";
    document.getElementById(modalId).style.display="flex";
    if(modalId==='teacherModal'){
        if(!teacherLoggedIn){
            teacherPanel.style.display='none';
            document.getElementById("password").value="";
            document.getElementById("password").style.display="block";
            document.getElementById("teacherButtons").style.display="block";
        } else {
            teacherPanel.style.display='block';
            document.getElementById("password").style.display="none";
            document.getElementById("teacherButtons").style.display="none";
        }
    }
}

function backToMain(modalId){
    document.getElementById(modalId).style.display="none";
    mainPanel.style.display="block";
}

function checkEnter(e){ if(e.key==="Enter"){ login(); } }

function login(){
    let p=document.getElementById("password").value;
    if(p==="Inomov"){
        alert("Xush kelibsiz, O‘qituvchi!");
        teacherPanel.style.display="block";
        teacherLoggedIn = true;
        document.getElementById("password").style.display="none";
        document.getElementById("teacherButtons").style.display="none";
    } else {
        alert("Noto‘g‘ri parol!");
    }
}

window.addEventListener('keydown', function(e){
    if(e.key==="Escape"){
        const modals = document.querySelectorAll('.modal');
        modals.forEach(m=>{
            if(m.style.display==='flex' && !teacherLoggedIn){
                m.style.display='none';
                mainPanel.style.display='block';
            }
        });
    }
});

document.querySelectorAll('.modal').forEach(m=>{
    m.addEventListener('click', function(e){
        if(e.target===m && !teacherLoggedIn){
            m.style.display='none';
            mainPanel.style.display='block';
        }
    });
});

function generateTestAndBack(){
    generateTestFromTextarea();
    alert("Test tayyor! Talabalar uni yechishi mumkin.");
    backToMain('teacherModal');
}

function generateTestFromTextarea(){
    const text = document.getElementById('questionsTextarea').value.trim();
    if(!text){ alert("Iltimos savollarni yozing!"); return; }

    let blocks = text.split('++++');
    studentTestQuestions = [];
    blocks.forEach(b=>{
        b = b.trim();
        if(!b) return;
        let lines = b.split('\n').map(l=>l.trim());
        let qText = lines[0];
        let answers = [];
        let correctIndexes = [];
        for(let i=1;i<lines.length;i++){
            if(lines[i].startsWith('====#')) { answers.push(lines[i].substring(5)); correctIndexes.push(answers.length-1); }
            else if(lines[i].startsWith('====')) answers.push(lines[i].substring(4));
        }
        studentTestQuestions.push({question:qText, answers, correctIndexes});
    });

    if(document.getElementById('shuffleQuestionsSelect').value==='ha') studentTestQuestions.sort(()=>Math.random()-0.5);
    if(document.getElementById('shuffleAnswersSelect').value==='ha') studentTestQuestions.forEach(q=>{ q.answers.sort(()=>Math.random()-0.5); });
    const qCount = parseInt(document.getElementById('questionCount').value);
    if(qCount < studentTestQuestions.length) studentTestQuestions = studentTestQuestions.slice(0,qCount);
    if(document.getElementById('questionOrder').value==='random') studentTestQuestions.sort(()=>Math.random()-0.5);
}

function startStudentTest(){
    const name = document.getElementById('studentName').value.trim();
    if(!name){ alert("Iltimos ismingizni kiriting!"); return; }
    const area = document.getElementById('studentTestArea');
    area.innerHTML = `<h3>Salom, ${name}. Testni yeching:</h3>`;
    area.style.display = "block";

    let html = '<form id="studentForm"><ol>';
    studentTestQuestions.forEach((q, idx)=>{
        html += `<li>${q.question}<ul>`;
        q.answers.forEach((a,aidx)=>{
            html += `<li><input type="checkbox" name="q${idx}" value="${aidx}"> ${a}</li>`;
        });
        html += '</ul></li>';
    });
    html += '</ol><button type="button" onclick="finishTest()">Yakunlash</button></form>';
    area.innerHTML += html;
}

function finishTest(){
    const form = document.getElementById('studentForm');
    let correct = 0;
    studentTestQuestions.forEach((q, idx)=>{
        const checked = Array.from(form.querySelectorAll(`input[name=q${idx}]:checked`)).map(i=>parseInt(i.value));
        if(JSON.stringify(checked.sort()) === JSON.stringify(q.correctIndexes.sort())) correct++;
    });
    const percent = Math.round((correct/studentTestQuestions.length)*100);
    const area = document.getElementById('studentTestArea');
    area.innerHTML += `<h3>Natija: ${percent}%</h3><p>To'g'ri javoblar: ${correct}/${studentTestQuestions.length}</p>`;
}
</script>

</body>
</html>
